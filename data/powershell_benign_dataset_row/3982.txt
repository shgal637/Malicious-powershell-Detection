function Test-AzureRmKubernetes{$resourceGroupName = Get-RandomResourceGroupName$kubeClusterName = Get-RandomClusterName$location = Get-ProviderLocation "Microsoft.ContainerService/managedClusters"try{New-AzResourceGroup -Name $resourceGroupName -Location $locationif (isLive) {$cred = $(createTestCredential "Unicorns" "Puppies")New-AzAks -ResourceGroupName $resourceGroupName -Name $kubeClusterName -ClientIdAndSecret $cred} else {New-AzAks -ResourceGroupName $resourceGroupName -Name $kubeClusterName}$cluster = Get-AzAks -ResourceGroupName $resourceGroupName -Name $kubeClusterNameAssert-NotNull $cluster.FqdnAssert-NotNull $cluster.DnsPrefixAssert-AreEqual 1 $cluster.AgentPoolProfiles.LengthAssert-AreEqual "1.8.1" $cluster.KubernetesVersionAssert-AreEqual 3 $cluster.AgentPoolProfiles[0].Count;$cluster = $cluster | Set-AzAks -NodeCount 2Assert-AreEqual 2 $cluster.AgentPoolProfiles[0].Count;$cluster | Import-AzAksCredential -Force$cluster | Remove-AzAks -Force}finally{Remove-AzResourceGroup -Name $resourceGroupName -Force}}