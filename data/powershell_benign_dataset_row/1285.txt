function Complete-CJob{[CmdletBinding()]param([Parameter(Mandatory=$true)][Management.Automation.Job[]][Alias('Jobs')]$Job,[Parameter()][int]$IntervalSeconds = 1)Use-CallerPreference -Cmdlet $PSCmdlet -Session $ExecutionContext.SessionStateWrite-Warning ('Complete-CJob is obsolete and will be removed in a future major version of Carbon. Use PowerShell''s `Wait-Job` cmdlet instead.')$errorAction = 'Continue'$params = $PSBoundParametersif( $PSBoundParameters.ContainsKey( 'ErrorAction' ) ){$errorAction = $PSBoundParameters.ErrorAction}trap { Write-Warning "Unhandled error found: $_" }$numFailed = 0do{Start-Sleep -Seconds $IntervalSeconds$jobsStillRunning = $falseforeach( $pendingJob in $Job ){$currentJob = Get-Job $pendingJob.Id -ErrorAction SilentlyContinueif( -not $currentJob ){Write-Verbose "Job with ID $($pendingJob.Id) doesn't exist."continue}try{Write-Verbose "Job $($currentJob.Name) is in the $($currentJob.State) state."$jobHeader = "if( $currentJob.State -eq 'Blocked' -or $currentJob.State -eq 'Stopped'){Write-Host $jobHeaderWrite-Verbose "Stopping job $($currentJob.Name)."Stop-Job -Job $currentJobWrite-Verbose "Receiving job $($currentJob.Name)."Receive-Job -Job $currentJob -ErrorAction $errorAction| Write-HostWrite-Verbose "Removing job $($currentJob.Name)."Remove-Job -Job $currentJob$numFailed += 1}elseif( $currentJob.State -eq 'Completed' -or $currentJob.State -eq 'Failed' ){Write-Host $jobHeaderWrite-Verbose "Receiving job $($currentJob.Name)."Receive-Job -Job $currentJob -ErrorAction $errorAction | Write-HostWrite-Verbose "Removing job $($currentJob.Name)."Remove-Job -Job $currentJobif( $currentJob.State -eq 'Failed' ){$numFailed += 1}}elseif( $currentJob.State -eq 'NotStarted' -or $currentJob.State -eq 'Running' ){$jobsStillRunning = $true}else{Write-Error "Found unknown job state $($currentJob.State)."}}catch{Write-Warning "Encountered error handling job $($currentJob.Name)."Write-Warning $_}}} while( $jobsStillRunning )return $numFailed}Set-Alias -Name 'Complete-Jobs' -Value 'Complete-CJob'