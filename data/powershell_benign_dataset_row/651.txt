$reportPortalUri = if ($env:PesterPortalUrl -eq $null) { 'http://localhost/reports' } else { $env:PesterPortalUrl }$reportServerUri = if ($env:PesterServerUrl -eq $null) { 'http://localhost/reportserver' } else { $env:PesterServerUrl }function VerifyFileWasDownloaded(){param([Parameter(Mandatory = $True)][string]$folderPath,[Parameter(Mandatory = $True)][string]$fileName)$localReportDownloaded = Get-ChildItem  $folderPath | Where-Object { $_.Name -eq $fileName }$localReportDownloaded | Should Not BeNullOrEmpty$localReportDownloadedPath = $folderPath +'\' + $fileName}Describe "Out-RsRestCatalogItem" {$rsFolderPath = ""$localFolderPath = ""BeforeEach {$folderName = 'SUT_OutRsRestCatalogItem_' + [guid]::NewGuid()New-RsRestFolder -ReportPortalUri $reportPortalUri -RsFolder / -FolderName $folderName$rsFolderPath = '/' + $folderName$localResourcesPath =   (Get-Item -Path ".\").FullName  + '\Tests\CatalogItems\testResources'Write-RsRestFolderContent -ReportPortalUri $reportPortalUri -Path $localResourcesPath -RsFolder $rsFolderPath$localFolderName = 'SutOutRsRestCatalogItemTest' + [guid]::NewGuid()$currentLocalPath = (Get-Item -Path ".\" ).FullName$localFolderPath = $currentLocalPath + '\' + $localFolderNameNew-Item -Path $localFolderPath -type "directory"}AfterEach {Remove-RsCatalogItem -ReportServerUri $reportServerUri -RsFolder $rsFolderPath -Confirm:$falseRemove-Item -Path $localFolderPath -Recurse}Context "ReportPortalUri parameter" {It "Should download a RDL file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath emptyReportOut-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'emptyReport.rdl'}It "Should download a RSD file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath UnDatasetOut-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'UnDataset.rsd'}It "Should download a RSDS file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath SutWriteRsFolderContent_DataSourceOut-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'SutWriteRsFolderContent_DataSource.rsds'}It "Should download a RSMOBILE file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath SimpleMobileReportOut-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'SimpleMobileReport.rsmobile'}It "Should download a PBIX file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath SimplePowerBIReportOut-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'SimplePowerBIReport.pbix'}It "Should download a XLS file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath 'OldExcelWorkbook.xls'Out-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'OldExcelWorkbook.xls'}It "Should download a XLSX file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath 'NewExcelWorkbook.xlsx'Out-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'NewExcelWorkbook.xlsx'}It "Should download a Resource file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath emptyFile.txtOut-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'emptyFile.txt'}It "Should download a KPI" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath NewKPIOut-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'NewKPI.kpi'}}Context "WebSession parameter" {$webSession = $nullBeforeEach {$webSession = New-RsRestSession -ReportPortalUri $reportPortalUri}It "Should download a RDL file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath emptyReportOut-RsRestCatalogItem -WebSession $webSession -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'emptyReport.rdl'}It "Should download a RSD file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath UnDatasetOut-RsRestCatalogItem -WebSession $webSession -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'UnDataset.rsd'}It "Should download a RSDS file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath SutWriteRsFolderContent_DataSourceOut-RsRestCatalogItem -WebSession $webSession -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'SutWriteRsFolderContent_DataSource.rsds'}It "Should download a RSMOBILE file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath SimpleMobileReportOut-RsRestCatalogItem -WebSession $webSession -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'SimpleMobileReport.rsmobile'}It "Should download a PBIX file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath SimplePowerBIReportOut-RsRestCatalogItem -WebSession $webSession -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'SimplePowerBIReport.pbix'}It "Should download a XLS file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath 'OldExcelWorkbook.xls'Out-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'OldExcelWorkbook.xls'}It "Should download a XLSX file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath 'NewExcelWorkbook.xlsx'Out-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'NewExcelWorkbook.xlsx'}It "Should download a Resource file" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath emptyFile.txtOut-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'emptyFile.txt'}It "Should download a KPI" {$itemPath = Join-Path -Path $rsFolderPath -ChildPath NewKPIOut-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $itemPath -Destination $localFolderPath -VerboseVerifyFileWasDownloaded -folderPath $localFolderPath -fileName 'NewKPI.kpi'}}}