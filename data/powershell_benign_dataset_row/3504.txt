function Test-GetApplicationInsights{$rgname = Get-ApplicationInsightsTestResourceName;try{$appName = "app" + $rgname;$loc = Get-ProviderLocation ResourceManagement;$kind = "web";New-AzResourceGroup -Name $rgname -Location $loc;$app = New-AzApplicationInsights -ResourceGroupName $rgname -Name $appName -Location $loc -Kind $kindAssert-AreEqual $app.Name $appNameAssert-AreEqual $app.Kind $kindAssert-NotNull $app.InstrumentationKey$apps = Get-AzApplicationInsights -ResourceGroupName $rgname;Assert-AreEqual $apps.count 1Assert-AreEqual $apps[0].Name $appNameAssert-AreEqual $apps[0].Kind $kindAssert-NotNull $apps[0].InstrumentationKeyRemove-AzApplicationInsights -ResourceGroupName $rgname -Name $appName;}finally{Clean-ResourceGroup $rgname}}function Test-NewApplicationInsights{$rgname = Get-ApplicationInsightsTestResourceName;try{$appName = "app" + $rgname;$loc = Get-ProviderLocation ResourceManagement;$kind = "web";New-AzResourceGroup -Name $rgname -Location $loc;$app = New-AzApplicationInsights -ResourceGroupName $rgname -Name $appName -Location $loc -Kind $kindAssert-AreEqual $app.Name $appNameAssert-AreEqual $app.Kind $kindAssert-NotNull $app.InstrumentationKey$app = Get-AzApplicationInsights -ResourceGroupName $rgname -Name $appName;Assert-AreEqual $app.Name $appNameAssert-AreEqual $app.Kind $kindAssert-NotNull $app.InstrumentationKeyRemove-AzApplicationInsights -ResourceGroupName $rgname -Name $appName;}finally{Clean-ResourceGroup $rgname}}function Test-RemoveApplicationInsights{$rgname = Get-ApplicationInsightsTestResourceName;try{$appName = "app" + $rgname;$loc = Get-ProviderLocation ResourceManagement;$kind = "web";New-AzResourceGroup -Name $rgname -Location $loc;New-AzApplicationInsights -ResourceGroupName $rgname -Name $appName -Location $loc -Kind $kind$app = Get-AzApplicationInsights -ResourceGroupName $rgname -Name $appName;Assert-NotNull $appAssert-AreEqual $app.Name $appNameAssert-AreEqual $app.Kind $kindAssert-NotNull $app.InstrumentationKeyRemove-AzApplicationInsights -ResourceGroupName $rgname -Name $appName;Assert-ThrowsContains { Get-AzApplicationInsights -ResourceGroupName $rgname -Name $appName } "not found"}finally{Clean-ResourceGroup $rgname}}