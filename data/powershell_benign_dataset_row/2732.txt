[CmdletBinding()]Param ([Parameter(Mandatory=$false)][int32]$BackMins=180)$BackTime=(Get-Date) - (New-TimeSpan -Minutes $BackMins)$RawEvents = Get-WinEvent -LogName "Microsoft-Windows-Sysmon/Operational" | Where-Object {$_.TimeCreated -ge $BackTime} | Where-Object { $_.Id -eq 3}$RawEvents | ForEach-Object {  $PropertyBag = @{HostName = $_.MachineNameVersion=$_.VersionEventType = $_.Message.Split(":")[0]EventID = $_.IdDateUTC = Get-Date ($_.Properties[0].Value) -format sProcessGuid = $_.Properties[1].ValueProcessId = $_.Properties[2].ValueImage = $_.Properties[3].ValueUser = $_.Properties[4].ValueProtocol = $_.Properties[5].ValueInitiated = $_.Properties[6].ValueSourceIsIpv6 = $_.Properties[7].ValueSourceIp = $_.Properties[8].ValueSourceHostname = $_.Properties[9].ValueSourcePort = $_.Properties[10].ValueSourcePortName = $_.Properties[11].ValueDestinationIsIpv6 = $_.Properties[12].ValueDestinationIp = $_.Properties[13].ValueDestinationHostname = $_.Properties[14].ValueDestinationPort = $_.Properties[15].ValueDestinationPortName = $_.Properties[16].Value}$Output = New-Object -TypeName PSCustomObject -Property $PropertyBag$Output | Select-Object HostName, Version, EventType, EventID, DateUTC, ProcessGuid, ProcessId, Image, User, Protocol, Initiated, SourceIsIpv6, SourceIp, SourceHostname, SourcePort, SourcePortName, DestinationIsIpv6, DestinationIp, DestinationHostname, DestinationPort, DestinationPortName}