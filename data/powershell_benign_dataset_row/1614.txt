function Get-BitLockerKey {param ([string]$comp = $env:COMPUTERNAME)if (!$comp.endswith('$')) {$comp += '$'}$compsearcher = [adsisearcher]"samaccountname=$comp"$compsearcher.PageSize = 200$compsearcher.PropertiesToLoad.Add('name') | Out-Null$compobj = $compsearcher.FindOne().Propertiesif (!$compobj) {throw "$comp not found"}$keysearcher = [adsisearcher]'objectclass=msFVE-RecoveryInformation'$keysearcher.SearchRoot = [string]$compobj.adspath.trim()$keysearcher.PageSize = 200$keysearcher.PropertiesToLoad.AddRange(('name', 'msFVE-RecoveryPassword'))$keys = $keysearcher.FindOne().Propertiesif ($keys) {$keys | % {try{ rv matches -ea stop }catch{}('' + $_.name) -match '^([^\{]+)\{([^\}]+)' | Out-Null$date = $Matches[1]$pwid = $Matches[2]New-Object psobject -Property @{Name = [string]$compobj.nameDate = $datePasswordID = $pwidBitLockerKey = [string]$_.'msfve-recoverypassword'} | select name, date, passwordid, bitlockerkey}} else {New-Object psobject -Property @{Name = [string]$compobj.nameDate = ''PasswordID = ''BitLockerKey = ''} | select name, date, passwordid, bitlockerkey}}