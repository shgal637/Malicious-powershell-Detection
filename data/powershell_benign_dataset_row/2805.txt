if (Get-Command logparser.exe) {$lpquery = @"SELECT count (AntispywareEnabled, AntispywareSignatureAge, AntispywareSignatureVersion,AntivirusEnabled, AntivirusSignatureAge, AntivirusSignatureVersion, BehaviorMonitorEnabled, Enabled,EngineVersion, IoavProtectionenabled, Name, NisEnabled,NisEngineVersion, NisSignatureVersion, OnAccessProtectionEnabled,ProductStatus, RealTimeScanDirection, RtpEnabled, SchemaVersion,Version) AS CNT,AntispywareEnabled, AntispywareSignatureAge, AntispywareSignatureVersion,AntivirusEnabled, AntivirusSignatureAge, AntivirusSignatureVersion, BehaviorMonitorEnabled, Enabled,EngineVersion, IoavProtectionenabled, Name, NisEnabled,NisEngineVersion, NisSignatureVersion, OnAccessProtectionEnabled,ProductStatus, RealTimeScanDirection, RtpEnabled, SchemaVersion,VersionFROM*AMHealthStatus.tsvGROUP BYAntispywareEnabled, AntispywareSignatureAge, AntispywareSignatureVersion,AntivirusEnabled, AntivirusSignatureAge, AntivirusSignatureVersion, BehaviorMonitorEnabled, Enabled,EngineVersion, IoavProtectionenabled, Name, NisEnabled,NisEngineVersion, NisSignatureVersion, OnAccessProtectionEnabled,ProductStatus, RealTimeScanDirection, RtpEnabled, SchemaVersion,VersionORDER BYCNT ASC"@& logparser -stats:off -i:csv -dtlines:0 -fixedsep:on -rtp:-1 "$lpquery"} else {$ScriptName = [System.IO.Path]::GetFileName($MyInvocation.ScriptName)"${ScriptName} requires logparser.exe in the path."}