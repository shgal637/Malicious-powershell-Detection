$reportPortalUri = if ($env:PesterPortalUrl -eq $null) { 'http://localhost/reports' } else { $env:PesterPortalUrl }$reportServerUri = if ($env:PesterServerUrl -eq $null) { 'http://localhost/reportserver' } else { $env:PesterServerUrl }function VerifyCatalogItemDoesNotExists(){param([Parameter(Mandatory = $True)][string]$itemName,[Parameter(Mandatory = $True)][string]$itemType,[Parameter(Mandatory = $True)][string]$folderPath,[string]$reportServerUri)$item = (Get-RsFolderContent -ReportServerUri $reportServerUri -RsFolder $folderPath) | Where-Object { $_.TypeName -eq $itemType -and $_.Name -eq $itemName }$item | Should BeNullOrEmpty}Describe "Remove-RsRestCatalogItem" {$rsFolderPath = ""$rsFolderPaths = [System.Collections.ArrayList]@()BeforeEach {$folderName = 'SUT_RemoveRsCatalogItem_' + [guid]::NewGuid()New-RsRestFolder -ReportPortalUri $reportPortalUri -RsFolder / -FolderName $folderName$rsFolderPath = '/' + $folderName$rsFolderPaths.Add($rsFolderPath)$localResourcesPath = (Get-Item -Path ".\").FullName  + '\Tests\CatalogItems\testResources'Write-RsRestFolderContent -ReportPortalUri $reportPortalUri -Path $localResourcesPath -RsFolder $rsFolderPath}AfterAll {foreach ($path in $rsFolderPaths){Remove-RsCatalogItem -ReportServerUri $reportServerUri -RsFolder $path -Confirm:$false}}Context "ReportPortalUri parameter" {It "Should delete a RDL item" {Remove-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem "$rsFolderPath/emptyReport" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType "Report" -itemName "emptyReport" -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a RSDS item" {Remove-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem "$rsFolderPath/SutWriteRsFolderContent_DataSource" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType "DataSource" -itemName "SutWriteRsFolderContent_DataSource" -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a RSD item" {Remove-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem "$rsFolderPath/UnDataset" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType 'DataSet' -itemName 'UnDataset' -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a RSMOBILE item" {Remove-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem "$rsFolderPath/SimpleMobileReport" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType 'MobileReport' -itemName 'SimpleMobileReport' -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a PBIX item" {Remove-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem "$rsFolderPath/SimplePowerBIReport" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType 'PowerBIReport' -itemName 'SimplePowerBIReport' -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a folder" {Remove-RsRestCatalogItem -ReportPortalUri $reportPortalUri -RsItem $rsFolderPath -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType 'Folder' -itemName $folderName -folderPath "/" -reportServerUri $reportServerUri}}Context "WebSession parameter" {$webSession = $nullBeforeEach {$webSession = New-RsRestSession -ReportPortalUri $reportPortalUri}It "Should delete a RDL item" {Remove-RsRestCatalogItem -WebSession $webSession -RsItem "$rsFolderPath/emptyReport" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType "Report" -itemName "emptyReport" -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a RSDS item" {Remove-RsRestCatalogItem -WebSession $webSession -RsItem "$rsFolderPath/SutWriteRsFolderContent_DataSource" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType "DataSource" -itemName "SutWriteRsFolderContent_DataSource" -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a RSD item" {Remove-RsRestCatalogItem -WebSession $webSession -RsItem "$rsFolderPath/UnDataset" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType 'DataSet' -itemName 'UnDataset' -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a RSMOBILE item" {Remove-RsRestCatalogItem -WebSession $webSession -RsItem "$rsFolderPath/SimpleMobileReport" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType 'MobileReport' -itemName 'SimpleMobileReport' -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a PBIX item" {Remove-RsRestCatalogItem -WebSession $webSession -RsItem "$rsFolderPath/SimplePowerBIReport" -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType 'PowerBIReport' -itemName 'SimplePowerBIReport' -folderPath $rsFolderPath -reportServerUri $reportServerUri}It "Should delete a folder" {Remove-RsRestCatalogItem -WebSession $webSession -RsItem $rsFolderPath -Verbose -Confirm:$falseVerifyCatalogItemDoesNotExists -itemType 'Folder' -itemName $folderName -folderPath "/" -reportServerUri $reportServerUri}}}