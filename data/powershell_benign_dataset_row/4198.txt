Function InitializeGlobalMemory {Set-Variable -Name Computers -Scope Global -ForceSet-Variable -Name Logfile -Scope Global -ForceSet-Variable -Name RelativePath -Scope Global -ForceSet-Variable -Name Webroot -Scope Global -Force$Global:Failures = @()$Global:RelativePath = (split-path $SCRIPT:MyInvocation.MyCommand.Path -parent)+"\" $Global:LogFile = $Global:RelativePath + "Output.csv"$Global:Computers = Get-Content -Path $Global:RelativePath"SCCMSystems.txt" -Force$Global:Webroot = Get-Content -Path $Global:RelativePath"AntivirusSystems.txt" -Force}Function ProcessLogFile {If ((Test-Path $Global:LogFile) -eq $true) {Remove-Item $Global:LogFile -Force}If ((Test-Path $Global:LogFile) -eq $false) {$temp = New-Item $Global:LogFile -ItemType File -Force$Output = ","+"Deletions"+","+","+","+"Additions"Out-File -FilePath $Global:LogFile -InputObject $Output -Append -Force -Encoding UTF8$Output = "Computer Name"+","+"Active Directory"+","+"SCCM"+","+"Antivirus"+","+"Antivirus"Out-File -FilePath $Global:LogFile -InputObject $Output -Append -Force -Encoding UTF8}}Function ProcessComputers {$obj = New-Object PSObject$Count = 0Foreach ($Computer in $Global:Computers) {cls$Antivirus = $false$Count += 1Write-Host "Processing "$Count" of " -NoNewlineWrite-Host $Global:Computers.CountWrite-HostWrite-Host "Computer Name: "$Computer$ADAccount = $nullWrite-Host "Testing AD Presence....." -NoNewline$ErrorActionPreference = 'SilentlyContinue'$ADAccount = Get-ADComputer $ComputerIf ($ADAccount -eq $null) {$ADAccount = $falseWrite-Host "Does not Exist" -ForegroundColor Red} else {$ADAccount = $trueWrite-Host "Exists" -ForegroundColor Yellow}Write-Host "Testing Antivirus....." -NoNewlineForeach ($system in $Global:Webroot) {If ($system -eq $Computer) {$Antivirus = $true}}If ($Antivirus -eq $true) {Write-Host "Exists" -ForegroundColor Yellow} else {Write-Host "Does not exist" -ForegroundColor Red}Write-Host "Testing Network Connectivity....." -NoNewlineIf ((Test-Connection -ComputerName $Computer -Quiet) -eq $false) {$NetworkTest = ping $ComputerIf ($NetworkTest -like '*Ping request could not find host*') {$NetworkTest = $falseWrite-Host "Does not exist" -ForegroundColor Red} else {$NetworkTest = $trueWrite-Host "Exists" -ForegroundColor Yellow}} else {$NetworkTest = $trueWrite-Host "Exists" -ForegroundColor Yellow}If (($ADAccount -eq $true) -and ($NetworkTest -eq $false)) {$obj | Add-Member -MemberType NoteProperty -Name ComputerName -Value $ComputerIf ($Antivirus -eq $true) {$obj | Add-Member -MemberType NoteProperty -Name Action -Value "AD_SCCM_Antivirus"} else {$obj | Add-Member -MemberType NoteProperty -Name Action -Value "AD_SCCM"}}If (($ADAccount -eq $false) -and ($NetworkTest -eq $false)) {$obj | Add-Member -MemberType NoteProperty -Name ComputerName -Value $ComputerIf ($Antivirus -eq $true) {$obj | Add-Member -MemberType NoteProperty -Name Action -Value "SCCM_Antivirus"} else {$obj | Add-Member -MemberType NoteProperty -Name Action -Value "SCCM"}}If (($ADAccount -eq $true) -and ($NetworkTest -eq $true) -and ($Antivirus -eq $false)) {$obj | Add-Member -MemberType NoteProperty -Name ComputerName -Value $Computer$obj | Add-Member -MemberType NoteProperty -Name Action -Value "AddAntivirus"}If ($obj -ne $null) {$Global:Failures += $obj$Output = $obj.ComputerNameIf ($obj.Action -eq "AD_SCCM") {$Output = $Output + ","+"X"+","+"X" }If ($obj.Action -eq "AD_SCCM_Antivirus") {$Output = $Output + ","+"X"+","+"X"+","+"X"}If ($obj.Action -eq "SCCM") {$Output = $Output + ","+","+"X"}If ($obj.Action -eq "SCCM_Antivirus") {$Output = $Output + ","+","+"X"+","+"X"}If ($obj.Action -eq "AddAntivirus") {$Output = $Output + ","+","+","+","+"X"}Out-File -FilePath $Global:LogFile -InputObject $Output -Append -Force -Encoding UTF8Remove-Variable -Name obj$obj = New-Object PSObject}Start-Sleep -Seconds 1}}Function WriteToScreen {clsForeach ($Failure in $Global:Failures) {If ($Failure -ne $null) {Write-Output $Failure}}$ErrorActionPreference = 'Continue'}clsImport-Module -Name ActiveDirectoryInitializeGlobalMemoryProcessLogFileProcessComputersWriteToScreen