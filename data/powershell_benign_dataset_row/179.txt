function Get-SCCMUserCollectionDeployment{[CmdletBinding()]PARAM([Parameter(Mandatory)][Alias('SamAccountName')]$UserName,[Parameter(Mandatory)]$SiteCode,[Parameter(Mandatory)]$ComputerName,[Alias('RunAs')][System.Management.Automation.Credential()]$Credential = [System.Management.Automation.PSCredential]::Empty,[ValidateSet('Required', 'Available')]$Purpose)BEGIN{if ($UserName -like '*\*') { $UserName = ($UserName -split '\\')[1] }$Splatting = @{ComputerName = $ComputerNameNameSpace = "root\SMS\Site_$SiteCode"}IF ($PSBoundParameters['Credential']){$Splatting.Credential = $Credential}Switch ($Purpose){"Required" { $DeploymentIntent = 0 }"Available" { $DeploymentIntent = 2 }default { $DeploymentIntent = "NA" }}Function Get-DeploymentIntentName{PARAM([Parameter(Mandatory)]$DeploymentIntent)PROCESS{if ($DeploymentIntent = 0) { Write-Output "Required" }if ($DeploymentIntent = 2) { Write-Output "Available" }if ($DeploymentIntent -ne 0 -and $DeploymentIntent -ne 2) { Write-Output "NA" }}}}PROCESS{$User = Get-WMIObject @Splatting -Query "Select * From SMS_R_User WHERE UserName='$UserName'"Get-WmiObject -Class sms_fullcollectionmembership @splatting -Filter "ResourceID = '$($user.resourceid)'" |ForEach-Object {$Collections = Get-WmiObject @splatting -Query "Select * From SMS_Collection WHERE CollectionID='$($_.Collectionid)'"Foreach ($Collection in $collections){IF ($DeploymentIntent -eq 'NA'){$Deployments = (Get-WmiObject @splatting -Query "Select * From SMS_DeploymentInfo WHERE CollectionID='$($Collection.CollectionID)'")}ELSE{$Deployments = (Get-WmiObject @splatting -Query "Select * From SMS_DeploymentInfo WHERE CollectionID='$($Collection.CollectionID)' AND DeploymentIntent='$DeploymentIntent'")}Foreach ($Deploy in $Deployments){$Properties = @{UserName = $UserNameComputerName = $ComputerNameCollectionName = $Deploy.CollectionNameCollectionID = $Deploy.CollectionIDDeploymentID = $Deploy.DeploymentIDDeploymentName = $Deploy.DeploymentNameDeploymentIntent = $deploy.DeploymentIntentDeploymentIntentName = (Get-DeploymentIntentName -DeploymentIntent $deploy.DeploymentIntent)TargetName = $Deploy.TargetNameTargetSubName = $Deploy.TargetSubname}New-Object -TypeName PSObject -prop $Properties}}}}}